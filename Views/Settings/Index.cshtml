@{
    ViewData["Title"] = "–ù–∞—Å—Ç—Ä–æ–π–∫–∏";
    var user = ViewBag.User as Sofia.Web.Models.User;
    var totalNotes = ViewBag.TotalNotes as int? ?? 0;
    var totalGoals = ViewBag.TotalGoals as int? ?? 0;
    var completedGoals = ViewBag.CompletedGoals as int? ?? 0;
    var sharedNotes = ViewBag.SharedNotes as int? ?? 0;
    var pinnedNotes = ViewBag.PinnedNotes as int? ?? 0;
    var totalEmotions = ViewBag.TotalEmotions as int? ?? 0;
    var recentNotes = ViewBag.RecentNotes as List<Sofia.Web.Models.Note>;
    var recentGoals = ViewBag.RecentGoals as List<Sofia.Web.Models.Goal>;
}

<div class="d-flex justify-content-between align-items-center mb-4">
    <h2>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
</div>

<!-- User Stats -->
<div class="row g-3 mb-4">
    <div class="col-md-3">
        <div class="card text-center h-100">
            <div class="card-body">
                <div class="h3 text-primary mb-2">@totalNotes</div>
                <div class="text-muted">–í—Å–µ–≥–æ –∑–∞–º–µ—Ç–æ–∫</div>
                <small class="text-success">@pinnedNotes –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–æ</small>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-center h-100">
            <div class="card-body">
                <div class="h3 text-success mb-2">@completedGoals</div>
                <div class="text-muted">–ó–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö —Ü–µ–ª–µ–π</div>
                <small class="text-info">@totalGoals –≤—Å–µ–≥–æ</small>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-center h-100">
            <div class="card-body">
                <div class="h3 text-info mb-2">@totalEmotions</div>
                <div class="text-muted">–ó–∞–ø–∏—Å–µ–π —ç–º–æ—Ü–∏–π</div>
                <small class="text-success">@sharedNotes –¥–ª—è –ø—Å–∏—Ö–æ–ª–æ–≥–∞</small>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-center h-100">
            <div class="card-body">
                <div class="h3 text-warning mb-2">@(totalGoals > 0 ? (completedGoals * 100 / totalGoals) : 0)%</div>
                <div class="text-muted">–£—Å–ø–µ—à–Ω–æ—Å—Ç—å —Ü–µ–ª–µ–π</div>
                <small class="text-muted">–ü—Ä–æ–≥—Ä–µ—Å—Å</small>
            </div>
        </div>
    </div>
</div>

<div class="row g-4">
    <!-- Settings Menu -->
    <div class="col-lg-8">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">‚öôÔ∏è –í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</h5>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-6">
                        <a href="/settings/profile" class="settings-link">
                            <div class="d-flex align-items-center p-3 border rounded">
                                <div class="me-3" style="font-size: 24px;">üë§</div>
                                <div>
                                    <h6 class="mb-1">–ü—Ä–æ—Ñ–∏–ª—å</h6>
                                    <small class="text-muted">–õ–∏—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∏ –∞–≤–∞—Ç–∞—Ä</small>
                                </div>
                            </div>
                        </a>
                    </div>
                    <div class="col-md-6">
                        <a href="/settings/preferences" class="settings-link">
                            <div class="d-flex align-items-center p-3 border rounded">
                                <div class="me-3" style="font-size: 24px;">üé®</div>
                                <div>
                                    <h6 class="mb-1">–ü—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è</h6>
                                    <small class="text-muted">–Ø–∑—ã–∫, –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</small>
                                </div>
                            </div>
                        </a>
                    </div>
                    <div class="col-md-6">
                        <a href="/notifications/settings" class="settings-link">
                            <div class="d-flex align-items-center p-3 border rounded">
                                <div class="me-3" style="font-size: 24px;">üîî</div>
                                <div>
                                    <h6 class="mb-1">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</h6>
                                    <small class="text-muted">–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –∏ –∞–ª–µ—Ä—Ç—ã</small>
                                </div>
                            </div>
                        </a>
                    </div>
                    <div class="col-md-6">
                        <a href="/home/companion" class="settings-link">
                            <div class="d-flex align-items-center p-3 border rounded">
                                <div class="me-3" style="font-size: 24px;">ü§ñ</div>
                                <div>
                                    <h6 class="mb-1">–ö–æ–º–ø–∞–Ω—å–µ–Ω</h6>
                                    <small class="text-muted">–ò–ò –ø–æ–º–æ—â–Ω–∏–∫ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞</small>
                                </div>
                            </div>
                        </a>
                    </div>
                    <div class="col-md-6">
                        <a href="/settings/data" class="settings-link">
                            <div class="d-flex align-items-center p-3 border rounded">
                                <div class="me-3" style="font-size: 24px;">üìä</div>
                                <div>
                                    <h6 class="mb-1">–î–∞–Ω–Ω—ã–µ</h6>
                                    <small class="text-muted">–≠–∫—Å–ø–æ—Ä—Ç –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</small>
                                </div>
                            </div>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Activity -->
    <div class="col-lg-4">
        <!-- Recent Notes -->
        <div class="card mb-4">
            <div class="card-header">
                <h6 class="mb-0">üìù –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏</h6>
            </div>
            <div class="card-body">
                @if (recentNotes?.Any() == true)
                {
                    <div class="recent-activity">
                        @foreach (var note in recentNotes.Take(3))
                        {
                            <div class="activity-item">
                                <div class="d-flex align-items-center">
                                    <span class="me-2">@GetEmotionEmoji(note.Emotion)</span>
                                    <div class="flex-grow-1">
                                        <div class="activity-text">@(note.Content.Length > 50 ? note.Content.Substring(0, 50) + "..." : note.Content)</div>
                                        <small class="text-muted">@note.CreatedAt.ToString("dd.MM HH:mm")</small>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                }
                else
                {
                    <div class="text-center text-muted">
                        <div style="font-size: 24px;">üìù</div>
                        <p class="mb-0">–ù–µ—Ç –∑–∞–º–µ—Ç–æ–∫</p>
                    </div>
                }
            </div>
        </div>

        <!-- Recent Goals -->
        <div class="card mb-4">
            <div class="card-header">
                <h6 class="mb-0">üéØ –ü–æ—Å–ª–µ–¥–Ω–∏–µ —Ü–µ–ª–∏</h6>
            </div>
            <div class="card-body">
                @if (recentGoals?.Any() == true)
                {
                    <div class="recent-activity">
                        @foreach (var goal in recentGoals.Take(3))
                        {
                            <div class="activity-item">
                                <div class="d-flex align-items-center">
                                    <span class="me-2">@GetGoalEmoji(goal.Type)</span>
                                    <div class="flex-grow-1">
                                        <div class="activity-text">@goal.Title</div>
                                        <div class="progress mt-1" style="height: 4px;">
                                            <div class="progress-bar @GetGoalProgressClass(goal.Status)" 
                                                 style="width: @goal.Progress%"></div>
                                        </div>
                                        <small class="text-muted">@goal.Progress% ‚Ä¢ @goal.Status</small>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                }
                else
                {
                    <div class="text-center text-muted">
                        <div style="font-size: 24px;">üéØ</div>
                        <p class="mb-0">–ù–µ—Ç —Ü–µ–ª–µ–π</p>
                    </div>
                }
            </div>
        </div>

        
    </div>
</div>

<style>
.setting-item {
    padding: 15px;
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    transition: all 0.2s ease;
}

.setting-item:hover {
    background: #f8f9fa;
    border-color: #6b7cff;
}

.settings-link {
    text-decoration: none;
    color: inherit;
}

.settings-link:hover {
    text-decoration: none;
    color: inherit;
}

.settings-link .border {
    transition: all 0.2s ease;
}

.settings-link:hover .border {
    border-color: #6b7cff !important;
    background: #f8f9fa;
}

.recent-activity {
    space-y: 10px;
}

.activity-item {
    padding: 10px 0;
    border-bottom: 1px solid #f3f4f6;
}

.activity-item:last-child {
    border-bottom: none;
}

.activity-text {
    font-size: 14px;
    color: #333;
    margin-bottom: 4px;
}

.card {
    transition: transform 0.2s ease;
}

.card:hover {
    transform: translateY(-2px);
}
</style>

<script>
function toggleTheme() {
    const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
    const newTheme = isDark ? 'light' : 'dark';
    
    document.documentElement.setAttribute('data-theme', newTheme);
    localStorage.setItem('theme', newTheme);
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è
    document.getElementById('themeToggle').checked = newTheme === 'dark';
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ–º—ã
document.addEventListener('DOMContentLoaded', function() {
    const savedTheme = localStorage.getItem('theme') || 'light';
    document.documentElement.setAttribute('data-theme', savedTheme);
    document.getElementById('themeToggle').checked = savedTheme === 'dark';
});

// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫
function saveSettings() {
    const settings = {
        notifications: document.getElementById('notificationsToggle').checked,
        emailUpdates: document.getElementById('emailToggle').checked,
        privacy: document.getElementById('privacyToggle').checked
    };
    
    localStorage.setItem('sofiaSettings', JSON.stringify(settings));
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
    const toast = document.createElement('div');
    toast.className = 'toast-notification';
    toast.textContent = '–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!';
    toast.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: #10b981;
        color: white;
        padding: 12px 20px;
        border-radius: 6px;
        z-index: 1000;
        animation: slideIn 0.3s ease;
    `;
    
    document.body.appendChild(toast);
    
    setTimeout(() => {
        toast.remove();
    }, 3000);
}

// –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º
document.getElementById('notificationsToggle').addEventListener('change', saveSettings);
document.getElementById('emailToggle').addEventListener('change', saveSettings);
document.getElementById('privacyToggle').addEventListener('change', saveSettings);
</script>

@functions {
    string GetEmotionEmoji(Sofia.Web.Models.EmotionType emotion)
    {
        return emotion switch
        {
            Sofia.Web.Models.EmotionType.VerySad => "üò¢",
            Sofia.Web.Models.EmotionType.Sad => "üòî",
            Sofia.Web.Models.EmotionType.Neutral => "üòê",
            Sofia.Web.Models.EmotionType.Happy => "üòä",
            Sofia.Web.Models.EmotionType.VeryHappy => "üòÑ",
            Sofia.Web.Models.EmotionType.Anxious => "üò∞",
            Sofia.Web.Models.EmotionType.Calm => "üòå",
            Sofia.Web.Models.EmotionType.Excited => "ü§©",
            Sofia.Web.Models.EmotionType.Frustrated => "üò§",
            Sofia.Web.Models.EmotionType.Grateful => "üôè",
            _ => "üòê"
        };
    }
    
    string GetGoalEmoji(Sofia.Web.Models.GoalType type)
    {
        return type switch
        {
            Sofia.Web.Models.GoalType.Personal => "üë§",
            Sofia.Web.Models.GoalType.Therapy => "ü©∫",
            Sofia.Web.Models.GoalType.Wellness => "üå±",
            Sofia.Web.Models.GoalType.Social => "üíï",
            Sofia.Web.Models.GoalType.Professional => "üíº",
            _ => "üéØ"
        };
    }
    
    string GetGoalProgressClass(Sofia.Web.Models.GoalStatus status)
    {
        return status switch
        {
            Sofia.Web.Models.GoalStatus.Completed => "bg-success",
            Sofia.Web.Models.GoalStatus.Active => "bg-primary",
            Sofia.Web.Models.GoalStatus.Paused => "bg-warning",
            Sofia.Web.Models.GoalStatus.Cancelled => "bg-danger",
            _ => "bg-secondary"
        };
    }
}


